#pragma once
#include "Application.h"

/// <summary>
/// コンパイル済み頂点シェーダー
/// Releaseビルド時（.exeファイル形式で実行する時）はこれを読み込む
/// </summary>
const BYTE g_PeraVS[] =
{
	 68,  88,  66,  67,  81, 234,
	198,  17,  51,  98, 132,  49,
	 54, 186, 249, 244,  19,  99,
	132,   6,   1,   0,   0,   0,
	 92,   2,   0,   0,   5,   0,
	  0,   0,  52,   0,   0,   0,
	160,   0,   0,   0, 244,   0,
	  0,   0,  76,   1,   0,   0,
	192,   1,   0,   0,  82,  68,
	 69,  70, 100,   0,   0,   0,
	  0,   0,   0,   0,   0,   0,
	  0,   0,   0,   0,   0,   0,
	 60,   0,   0,   0,   0,   5,
	254, 255,   0,   1,   0,   0,
	 60,   0,   0,   0,  82,  68,
	 49,  49,  60,   0,   0,   0,
	 24,   0,   0,   0,  32,   0,
	  0,   0,  40,   0,   0,   0,
	 36,   0,   0,   0,  12,   0,
	  0,   0,   0,   0,   0,   0,
	 77, 105,  99, 114, 111, 115,
	111, 102, 116,  32,  40,  82,
	 41,  32,  72,  76,  83,  76,
	 32,  83, 104,  97, 100, 101,
	114,  32,  67, 111, 109, 112,
	105, 108, 101, 114,  32,  49,
	 48,  46,  49,   0,  73,  83,
	 71,  78,  76,   0,   0,   0,
	  2,   0,   0,   0,   8,   0,
	  0,   0,  56,   0,   0,   0,
	  0,   0,   0,   0,   0,   0,
	  0,   0,   3,   0,   0,   0,
	  0,   0,   0,   0,  15,  15,
	  0,   0,  65,   0,   0,   0,
	  0,   0,   0,   0,   0,   0,
	  0,   0,   3,   0,   0,   0,
	  1,   0,   0,   0,   3,   3,
	  0,   0,  80,  79,  83,  73,
	 84,  73,  79,  78,   0,  84,
	 69,  88,  67,  79,  79,  82,
	 68,   0, 171, 171,  79,  83,
	 71,  78,  80,   0,   0,   0,
	  2,   0,   0,   0,   8,   0,
	  0,   0,  56,   0,   0,   0,
	  0,   0,   0,   0,   1,   0,
	  0,   0,   3,   0,   0,   0,
	  0,   0,   0,   0,  15,   0,
	  0,   0,  68,   0,   0,   0,
	  0,   0,   0,   0,   0,   0,
	  0,   0,   3,   0,   0,   0,
	  1,   0,   0,   0,   3,  12,
	  0,   0,  83,  86,  95,  80,
	 79,  83,  73,  84,  73,  79,
	 78,   0,  84,  69,  88,  67,
	 79,  79,  82,  68,   0, 171,
	171, 171,  83,  72,  69,  88,
	108,   0,   0,   0,  80,   0,
	  1,   0,  27,   0,   0,   0,
	106,   8,   0,   1,  95,   0,
	  0,   3, 242,  16,  16,   0,
	  0,   0,   0,   0,  95,   0,
	  0,   3,  50,  16,  16,   0,
	  1,   0,   0,   0, 103,   0,
	  0,   4, 242,  32,  16,   0,
	  0,   0,   0,   0,   1,   0,
	  0,   0, 101,   0,   0,   3,
	 50,  32,  16,   0,   1,   0,
	  0,   0,  54,   0,   0,   5,
	242,  32,  16,   0,   0,   0,
	  0,   0,  70,  30,  16,   0,
	  0,   0,   0,   0,  54,   0,
	  0,   5,  50,  32,  16,   0,
	  1,   0,   0,   0,  70,  16,
	 16,   0,   1,   0,   0,   0,
	 62,   0,   0,   1,  83,  84,
	 65,  84, 148,   0,   0,   0,
	  3,   0,   0,   0,   0,   0,
	  0,   0,   0,   0,   0,   0,
	  4,   0,   0,   0,   0,   0,
	  0,   0,   0,   0,   0,   0,
	  0,   0,   0,   0,   1,   0,
	  0,   0,   0,   0,   0,   0,
	  0,   0,   0,   0,   0,   0,
	  0,   0,   0,   0,   0,   0,
	  0,   0,   0,   0,   0,   0,
	  0,   0,   0,   0,   0,   0,
	  0,   0,   0,   0,   0,   0,
	  0,   0,   0,   0,   0,   0,
	  0,   0,   0,   0,   2,   0,
	  0,   0,   0,   0,   0,   0,
	  0,   0,   0,   0,   0,   0,
	  0,   0,   0,   0,   0,   0,
	  0,   0,   0,   0,   0,   0,
	  0,   0,   0,   0,   0,   0,
	  0,   0,   0,   0,   0,   0,
	  0,   0,   0,   0,   0,   0,
	  0,   0,   0,   0,   0,   0,
	  0,   0,   0,   0,   0,   0,
	  0,   0,   0,   0,   0,   0,
	  0,   0,   0,   0,   0,   0,
	  0,   0,   0,   0
};

/// <summary>
/// コンパイル済みピクセルシェーダー
/// </summary>
const BYTE g_PeraPS[] =
{
	 68,  88,  66,  67,  73, 248,
	 64,  61, 217, 204,  46,  86,
	 65, 205, 136, 141,  62, 138,
	101,  30,   1,   0,   0,   0,
	120,   3,   0,   0,   5,   0,
	  0,   0,  52,   0,   0,   0,
	128,   1,   0,   0, 216,   1,
	  0,   0,  12,   2,   0,   0,
	220,   2,   0,   0,  82,  68,
	 69,  70,  68,   1,   0,   0,
	  1,   0,   0,   0, 172,   0,
	  0,   0,   3,   0,   0,   0,
	 60,   0,   0,   0,   0,   5,
	255, 255,   0,   1,   0,   0,
	 28,   1,   0,   0,  82,  68,
	 49,  49,  60,   0,   0,   0,
	 24,   0,   0,   0,  32,   0,
	  0,   0,  40,   0,   0,   0,
	 36,   0,   0,   0,  12,   0,
	  0,   0,   0,   0,   0,   0,
	156,   0,   0,   0,   3,   0,
	  0,   0,   0,   0,   0,   0,
	  0,   0,   0,   0,   0,   0,
	  0,   0,   0,   0,   0,   0,
	  1,   0,   0,   0,   1,   0,
	  0,   0, 160,   0,   0,   0,
	  2,   0,   0,   0,   5,   0,
	  0,   0,   4,   0,   0,   0,
	255, 255, 255, 255,   0,   0,
	  0,   0,   1,   0,   0,   0,
	 13,   0,   0,   0, 164,   0,
	  0,   0,   0,   0,   0,   0,
	  0,   0,   0,   0,   0,   0,
	  0,   0,   0,   0,   0,   0,
	  0,   0,   0,   0,   1,   0,
	  0,   0,   1,   0,   0,   0,
	115, 109, 112,   0, 116, 101,
	120,   0,  70,  97, 100, 101,
	  0, 171, 171, 171, 164,   0,
	  0,   0,   1,   0,   0,   0,
	196,   0,   0,   0,  16,   0,
	  0,   0,   0,   0,   0,   0,
	  0,   0,   0,   0, 236,   0,
	  0,   0,   0,   0,   0,   0,
	  4,   0,   0,   0,   2,   0,
	  0,   0, 248,   0,   0,   0,
	  0,   0,   0,   0, 255, 255,
	255, 255,   0,   0,   0,   0,
	255, 255, 255, 255,   0,   0,
	  0,   0, 102,  97, 100, 101,
	  0, 102, 108, 111,  97, 116,
	  0, 171,   0,   0,   3,   0,
	  1,   0,   1,   0,   0,   0,
	  0,   0,   0,   0,   0,   0,
	  0,   0,   0,   0,   0,   0,
	  0,   0,   0,   0,   0,   0,
	  0,   0,   0,   0, 241,   0,
	  0,   0,  77, 105,  99, 114,
	111, 115, 111, 102, 116,  32,
	 40,  82,  41,  32,  72,  76,
	 83,  76,  32,  83, 104,  97,
	100, 101, 114,  32,  67, 111,
	109, 112, 105, 108, 101, 114,
	 32,  49,  48,  46,  49,   0,
	 73,  83,  71,  78,  80,   0,
	  0,   0,   2,   0,   0,   0,
	  8,   0,   0,   0,  56,   0,
	  0,   0,   0,   0,   0,   0,
	  1,   0,   0,   0,   3,   0,
	  0,   0,   0,   0,   0,   0,
	 15,   0,   0,   0,  68,   0,
	  0,   0,   0,   0,   0,   0,
	  0,   0,   0,   0,   3,   0,
	  0,   0,   1,   0,   0,   0,
	  3,   3,   0,   0,  83,  86,
	 95,  80,  79,  83,  73,  84,
	 73,  79,  78,   0,  84,  69,
	 88,  67,  79,  79,  82,  68,
	  0, 171, 171, 171,  79,  83,
	 71,  78,  44,   0,   0,   0,
	  1,   0,   0,   0,   8,   0,
	  0,   0,  32,   0,   0,   0,
	  0,   0,   0,   0,   0,   0,
	  0,   0,   3,   0,   0,   0,
	  0,   0,   0,   0,  15,   0,
	  0,   0,  83,  86,  95,  84,
	 65,  82,  71,  69,  84,   0,
	171, 171,  83,  72,  69,  88,
	200,   0,   0,   0,  80,   0,
	  0,   0,  50,   0,   0,   0,
	106,   8,   0,   1,  89,   0,
	  0,   4,  70, 142,  32,   0,
	  0,   0,   0,   0,   1,   0,
	  0,   0,  90,   0,   0,   3,
	  0,  96,  16,   0,   0,   0,
	  0,   0,  88,  24,   0,   4,
	  0, 112,  16,   0,   0,   0,
	  0,   0,  85,  85,   0,   0,
	 98,  16,   0,   3,  50,  16,
	 16,   0,   1,   0,   0,   0,
	101,   0,   0,   3, 242,  32,
	 16,   0,   0,   0,   0,   0,
	104,   0,   0,   2,   1,   0,
	  0,   0,  69,   0,   0, 139,
	194,   0,   0, 128,  67,  85,
	 21,   0, 242,   0,  16,   0,
	  0,   0,   0,   0,  70,  16,
	 16,   0,   1,   0,   0,   0,
	 70, 126,  16,   0,   0,   0,
	  0,   0,   0,  96,  16,   0,
	  0,   0,   0,   0,  50,   0,
	  0,  11, 114,  32,  16,   0,
	  0,   0,   0,   0,  70,   2,
	 16, 128,  65,   0,   0,   0,
	  0,   0,   0,   0,   6, 128,
	 32,   0,   0,   0,   0,   0,
	  0,   0,   0,   0,  70,   2,
	 16,   0,   0,   0,   0,   0,
	 54,   0,   0,   5, 130,  32,
	 16,   0,   0,   0,   0,   0,
	 58,   0,  16,   0,   0,   0,
	  0,   0,  62,   0,   0,   1,
	 83,  84,  65,  84, 148,   0,
	  0,   0,   4,   0,   0,   0,
	  1,   0,   0,   0,   0,   0,
	  0,   0,   2,   0,   0,   0,
	  1,   0,   0,   0,   0,   0,
	  0,   0,   0,   0,   0,   0,
	  1,   0,   0,   0,   0,   0,
	  0,   0,   0,   0,   0,   0,
	  0,   0,   0,   0,   0,   0,
	  0,   0,   0,   0,   0,   0,
	  0,   0,   0,   0,   1,   0,
	  0,   0,   0,   0,   0,   0,
	  0,   0,   0,   0,   0,   0,
	  0,   0,   0,   0,   0,   0,
	  1,   0,   0,   0,   0,   0,
	  0,   0,   0,   0,   0,   0,
	  0,   0,   0,   0,   0,   0,
	  0,   0,   0,   0,   0,   0,
	  0,   0,   0,   0,   0,   0,
	  0,   0,   0,   0,   0,   0,
	  0,   0,   0,   0,   0,   0,
	  0,   0,   0,   0,   0,   0,
	  0,   0,   0,   0,   0,   0,
	  0,   0,   0,   0,   0,   0,
	  0,   0,   0,   0,   0,   0,
	  0,   0,   0,   0,   0,   0
};

/// <summary>
/// 画面そのものに関する表示処理、エフェクトを管理するクラス
/// </summary>
class Dx12Wrapper;
class PeraRenderer
{
private:
	//ペラポリゴン用の頂点バッファー
	ComPtr<ID3D12Resource> _peraVB;					
	//RTV/SRV両方を書き込むためのリソース
	ComPtr<ID3D12Resource> _peraResource;			
	//RTV用ヒープ
	ComPtr<ID3D12DescriptorHeap> _peraRTVHeap;		
	//SRV用ヒープ
	ComPtr<ID3D12DescriptorHeap> _peraSRVHeap;		
	//ペラポリゴン用のパイプラインステート
	ComPtr<ID3D12PipelineState> _peraPipeline;		
	//ペラポリゴン用のルートシグネチャ
	ComPtr<ID3D12RootSignature> _peraRS;			
	//ペラポリゴン用の頂点バッファービュー
	D3D12_VERTEX_BUFFER_VIEW _peraVBV = {};			

	//コンストラクタ
	PeraRenderer();
	PeraRenderer(const PeraRenderer&) = delete;
	//デストラクタ
	~PeraRenderer();

	//ペラポリゴン用RT・SR・RTV・SRVを作成する関数
	HRESULT CreatePeraResourcesAndView();			
	//ペラポリゴン用頂点バッファー・VBVを作成する関数
	HRESULT CreatePeraVertex();						
	//ペラポリゴン用パイプラインを作成する関数
	HRESULT CreatePeraPipeline();					

public:
	//シングルトンを返す
	static PeraRenderer& Instance();

	//初期化
	void Init();

	//ペラポリゴン用リソースの遷移(SHADER_RESOURCE→RENDER_TARGET)・RTVのセットを実行する関数
	void BeginPeraDraw();		
	//ペラポリゴン用ルートシグネチャ・パイプラインをセットする関数
	void SetPeraPipelines();					
	//ペラポリゴン用リソースの遷移(RENDER_TARGET→SHADER_RESOURCE)を実行する関数
	void EndPeraDraw();							

	//ペラポリゴン用頂点バッファービューを返す関数
	D3D12_VERTEX_BUFFER_VIEW* PeraVBView();		
	//ペラポリゴン用パイプラインを返す関数
	ID3D12PipelineState* PeraPipeline();		
	//ペラポリゴン用ルートシグネチャを返す関数
	ID3D12RootSignature* PeraRootSignature();	
};